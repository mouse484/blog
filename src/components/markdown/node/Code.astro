---
import type { Code } from 'mdast'
import { toHtml } from 'expressive-code/hast'
import { ec, baseStyles, themeStyles, jsModules } from '../../utils/syntax-hilight.ts'

interface Props {
  node: Code
}
const { node } = Astro.props

const [language = '', filename] = node.lang?.split(':') ?? []
const content = node.value

const { renderedGroupAst, styles: blockStyles } = await ec.render({
  code: content,
  language,
  props: {
    title: filename,
  },
})

const styleString = [baseStyles, themeStyles, ...blockStyles].join('')

const html = toHtml(renderedGroupAst)
---

<Fragment set:html={html} />

<style is:inline set:html={styleString}></style>
<script set:html={jsModules.join('')} />
